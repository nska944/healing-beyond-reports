<!DOCTYPE html>
<html>
<head>
  <title>Healing Beyond Reports</title>
  <link rel="stylesheet" href="/static/style.css">

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>

<body>
<div class="container">

  <div class="card" style="text-align:center">
    <h1>Healing Beyond Reports</h1>
    <p style="color:var(--muted)">
      Prototype of AI-assisted Personal Health Record<br>
      using Machine Learning and NLP
    </p>

    <button onclick="loginWithGoogle()">Login with Google</button>

    <form id="tokenForm" method="POST" action="/firebase_login">
      <input type="hidden" name="idToken" id="idToken">
    </form>
  </div>

  <footer>
    <p><b>Presented by</b></p>
    <p>
      Vinuthashree Gowd (1BG22AI116) Â·
      Preethi M (1BG22AI080) Â·
      Yashavanthagowda R G (1BG22AI411)
    </p>

    <p><b>Under the guidance of</b><br>
      Dr. Kirti J, Assistant Professor
    </p>

    <p>
      Department of AI & ML<br>
      BNM Institute of Technology, Bengaluru â€“ 560070
    </p>
  </footer>

</div>

<script>
  // ðŸ”¥ FULL Firebase config (must be complete)
  const firebaseConfig = {
    apiKey: "AIzaSyBx8wgb2-gdv8kzQOHn3DRUkZEEErVCn3Y",
    authDomain: "meditrace-ai.firebaseapp.com",
    projectId: "meditrace-ai",
    storageBucket: "meditrace-ai.appspot.com",
    messagingSenderId: "432950812332",
    appId: "1:432950812332:web:51746650fdbba964b3c909"
  };

  firebase.initializeApp(firebaseConfig);

  function loginWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();

    firebase.auth()
      .signInWithPopup(provider)
      .then(result => result.user.getIdToken())
      .then(token => {
        document.getElementById("idToken").value = token;
        document.getElementById("tokenForm").submit();
      })
      .catch(error => {
        console.error("Popup failed, falling back to redirect", error);

        // âœ… POPUP FAILED â†’ USE REDIRECT (bullet-proof)
        firebase.auth().signInWithRedirect(provider);
      });
  }

  // ðŸ” Handle redirect result (important)
  firebase.auth()
    .getRedirectResult()
    .then(result => {
      if (result.user) {
        return result.user.getIdToken();
      }
    })
    .then(token => {
      if (token) {
        document.getElementById("idToken").value = token;
        document.getElementById("tokenForm").submit();
      }
    })
    .catch(err => console.error("Redirect error:", err));
</script>

</body>
</html>
