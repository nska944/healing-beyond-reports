<!DOCTYPE html>
<html lang="en">
<head>
  <title>Healing Beyond Reports</title>
  <link rel="stylesheet" href="/static/style.css">

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>

<body>
<div class="container">

  <div class="card center">
    <h1>Healing Beyond Reports</h1>
    <p class="subtitle">
      Prototype of AI-assisted Personal Health Record<br>
      using Machine Learning & NLP
    </p>

    <button class="google-btn" onclick="loginWithGoogle()">
      Sign in with Google
    </button>

    <form id="tokenForm" method="POST" action="/firebase_login">
      <input type="hidden" name="idToken" id="idToken">
    </form>
  </div>

  <footer>
    <p><b>Presented by</b></p>
    <p>
      Vinuthashree Gowd Â· Preethi M Â· Yashavanthagowda R G
    </p>

    <p><b>Under the guidance of</b><br>
      Dr. Kirti J, Assistant Professor
    </p>

    <p>
      Dept. of AI & ML<br>
      BNM Institute of Technology, Bengaluru
    </p>
  </footer>

</div>

<script>
  // ðŸ”¥ Firebase Web Config (Frontend only)
  const firebaseConfig = {
    apiKey: "AIzaSyBx8wgb2-gdv8kzQOHn3DRUkZEEErVCn3Y",
    authDomain: "meditrace-ai.firebaseapp.com",
    projectId: "meditrace-ai",
    storageBucket: "meditrace-ai.appspot.com",
    messagingSenderId: "432950812332",
    appId: "1:432950812332:web:51746650fdbba964b3c909"
  };

  firebase.initializeApp(firebaseConfig);

  function loginWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();

    firebase.auth()
      .signInWithPopup(provider)
      .then(res => res.user.getIdToken())
      .then(token => {
        document.getElementById("idToken").value = token;
        document.getElementById("tokenForm").submit();
      })
      .catch(err => {
        console.warn("Popup blocked, using redirect", err);
        firebase.auth().signInWithRedirect(provider);
      });
  }

  // Handle redirect login (mobile / popup blocked)
  firebase.auth()
    .getRedirectResult()
    .then(result => {
      if (result.user) {
        return result.user.getIdToken();
      }
    })
    .then(token => {
      if (token) {
        document.getElementById("idToken").value = token;
        document.getElementById("tokenForm").submit();
      }
    })
    .catch(err => console.error("Redirect auth error:", err));
</script>

</body>
</html>
